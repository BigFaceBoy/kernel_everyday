# rope
- rope_f32_kernel
- rope_f32x4_kernel(float4向量化版本)

假设input为 $q = [q_0, q_1, ..., q_n]$.  
第一步：分组
$$
[q_0,q_1], [q_2, q_3], ..., [q_{n-1}, q_n]
$$

第二步：应用二维旋转矩阵,对于第 i 对$[q_{2i}, q_{2i+1}]$

$$
\begin{bmatrix}
    q^{'}_{2i} \\
    q^{'}_{2i+1}
\end{bmatrix} = 
\begin{bmatrix} 
cos(m\theta_i) \quad -sin(m\theta_i) \\
sin(m\theta_i) \quad cos(m\theta_i)
\end{bmatrix}
\begin{bmatrix}
q_{2i} \\
q_{2i+1}
\end{bmatrix}
$$

其中, 

$$\theta_i = 10000^{-2(i-1)/n}, i=1,2,...,n/2$$


# benchmark
```
----------------------------------------------------------------------------------------------------
                                        M=4096, N=512
----------------------------------------------------------------------------------------------------
             out_f32: ['0.61112261  ', '-0.95748937 ', '-0.38607439 '], time:0.011873ms
      out_f32x4_pack: ['0.61112261  ', '-0.95748937 ', '-0.38607439 '], time:0.009096ms
          out_f32_th: ['0.61112261  ', '-0.95748937 ', '-0.38607439 '], time:4.509890ms
----------------------------------------------------------------------------------------------------
                                        M=4096, N=1024
----------------------------------------------------------------------------------------------------
             out_f32: ['-0.98559546 ', '1.2654953   ', '-1.04775882 '], time:0.014806ms
      out_f32x4_pack: ['-0.98559546 ', '1.2654953   ', '-1.04775882 '], time:0.009227ms
          out_f32_th: ['-0.98559546 ', '1.2654953   ', '-1.04775882 '], time:4.114628ms
----------------------------------------------------------------------------------------------------
                                        M=8192, N=512
----------------------------------------------------------------------------------------------------
             out_f32: ['-0.03886978 ', '-0.01819785 ', '-1.52474093 '], time:0.014305ms
      out_f32x4_pack: ['-0.03886978 ', '-0.01819785 ', '-1.52474093 '], time:0.009966ms
          out_f32_th: ['-0.03886978 ', '-0.01819785 ', '-1.52474093 '], time:3.218424ms
----------------------------------------------------------------------------------------------------
                                        M=8192, N=1024
----------------------------------------------------------------------------------------------------
             out_f32: ['1.5187993   ', '0.74539393  ', '-0.54005754 '], time:0.021636ms
      out_f32x4_pack: ['1.5187993   ', '0.74539393  ', '-0.54005754 '], time:0.011909ms
          out_f32_th: ['1.5187993   ', '0.74539393  ', '-0.54005754 '], time:7.494640ms
----------------------------------------------------------------------------------------------------
```