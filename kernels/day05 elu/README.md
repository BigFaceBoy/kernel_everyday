elu:
$$f(x)=\begin{cases}
x &\text{if x >=  0} \\
\alpha(e^x - 1) &\text{if x < 0} \\
\end{cases}$$
其中，$\alpha$是一个超参数，通常取值为1。


# f16_kernel
一开始我的实现是：
```C++
#define alpha 1.0f
const half half_1 = __float2half(1.0f);

__global__ void elu_f16_kernel(half *x, half *y, int N){
    int idx = blockIdx.x * blockDim.x + threadIdx.x;
    if(idx < N){
        y[idx] = x[idx] >= 0 ? x[idx] : alpha * (hexp(x[idx]) - half_1);
    }
}

__global__ void elu_f16x2_kernel(half *x, half *y, int N){
    int idx =  2 * (blockIdx.x * blockDim.x + threadIdx.x);
    if(idx + 1 < N){
        half2 reg_x = reinterpret_cast<half2*>(x)[idx];
        half2 reg_y;

        reg_y.x = reg_x.x >= 0 ? reg_x.x : alpha *  (hexp(reg_x.x) - half_1);
        reg_y.y = reg_x.y >= 0 ? reg_x.y : alpha *  (hexp(reg_x.y) - half_1);

        reinterpret_cast<half2*>(y)[idx] = reg_y;
    }
}
```
看了`示例`的代码才意识到 half 的所有计算都有专门的运算函数。于是按 `示例` 做了调整。
```
__device__ __forceinline__ half elu_half(half x) {
  return __hgt(x, __float2half(0.f))
             ? x
             : __hmul(__float2half(alpha), __hsub(hexp(x), __float2half(1.f)));
}


__global__ void elu_f16_kernel(half *x, half *y, int N){
    int idx = blockIdx.x * blockDim.x + threadIdx.x;
    if(idx < N){
        y[idx] =  elu_half(x[idx]);
    }
}
```

# benchmark
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: ['-0.12506753 ', '0.06261222  '], time:0.00971889ms
         out_f32x4: ['-0.12506753 ', '0.06261222  '], time:0.00883627ms
        out_f32_th: ['-0.12506753 ', '0.06261222  '], time:0.06717229ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.125      ', '0.06262207  '], time:0.00984406ms
         out_f16x2: ['-0.125      ', '0.06262207  '], time:0.00838780ms
         out_f16x8: ['-0.125      ', '0.06262207  '], time:0.00836253ms
     out_f16x8pack: ['-0.125      ', '0.06262207  '], time:0.00820231ms
        out_f16_th: ['-0.125      ', '0.06262207  '], time:0.06515026ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: ['-0.45012712 ', '-0.59825021 '], time:0.01168442ms
         out_f32x4: ['-0.45012712 ', '-0.59825021 '], time:0.01059675ms
        out_f32_th: ['-0.45012712 ', '-0.59825015 '], time:0.07688904ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.45019531 ', '-0.59863281 '], time:0.01180434ms
         out_f16x2: ['-0.45019531 ', '-0.59863281 '], time:0.01065111ms
         out_f16x8: ['-0.45019531 ', '-0.59863281 '], time:0.00926471ms
     out_f16x8pack: ['-0.45019531 ', '-0.59863281 '], time:0.00928640ms
        out_f16_th: ['-0.45019531 ', '-0.59863281 '], time:0.06815982ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: ['-0.38398099 ', '-0.59642661 '], time:0.01607490ms
         out_f32x4: ['-0.38398099 ', '-0.59642661 '], time:0.01359725ms
        out_f32_th: ['-0.38398099 ', '-0.59642661 '], time:0.09345746ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.38378906 ', '-0.59667969 '], time:0.01615858ms
         out_f16x2: ['-0.38378906 ', '-0.59667969 '], time:0.01597691ms
         out_f16x8: ['-0.38378906 ', '-0.59667969 '], time:0.01119590ms
     out_f16x8pack: ['-0.38378906 ', '-0.59667969 '], time:0.01089716ms
        out_f16_th: ['-0.38378906 ', '-0.59667969 '], time:0.07616305ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: ['-0.32051486 ', '1.19150794  '], time:0.01218104ms
         out_f32x4: ['-0.32051486 ', '1.19150794  '], time:0.01052690ms
        out_f32_th: ['-0.32051486 ', '1.19150794  '], time:0.07595277ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.3203125  ', '1.19140625  '], time:0.01276493ms
         out_f16x2: ['-0.3203125  ', '1.19140625  '], time:0.00978637ms
         out_f16x8: ['-0.3203125  ', '1.19140625  '], time:0.00923562ms
     out_f16x8pack: ['-0.3203125  ', '1.19140625  '], time:0.00922847ms
        out_f16_th: ['-0.3203125  ', '1.19140625  '], time:0.06799150ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: ['1.11502695  ', '-0.53532577 '], time:0.01608348ms
         out_f32x4: ['1.11502695  ', '-0.53532577 '], time:0.01375866ms
        out_f32_th: ['1.11502695  ', '-0.53532577 '], time:0.09332371ms
-------------------------------------------------------------------------------------
           out_f16: ['1.11523438  ', '-0.53515625 '], time:0.01613426ms
         out_f16x2: ['1.11523438  ', '-0.53515625 '], time:0.01412296ms
         out_f16x8: ['1.11523438  ', '-0.53515625 '], time:0.01114941ms
     out_f16x8pack: ['1.11523438  ', '-0.53515625 '], time:0.01087427ms
        out_f16_th: ['1.11523438  ', '-0.53515625 '], time:0.07597947ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: ['-0.50504208 ', '-0.68239236 '], time:0.02476764ms
         out_f32x4: ['-0.50504208 ', '-0.68239236 '], time:0.02043509ms
        out_f32_th: ['-0.50504208 ', '-0.68239236 '], time:0.28316259ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.50488281 ', '-0.68212891 '], time:0.02487087ms
         out_f16x2: ['-0.50488281 ', '-0.68212891 '], time:0.02463388ms
         out_f16x8: ['-0.50488281 ', '-0.68212891 '], time:0.01449919ms
     out_f16x8pack: ['-0.50488281 ', '-0.68212891 '], time:0.01426411ms
        out_f16_th: ['-0.50488281 ', '-0.68212891 '], time:0.09499836ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: ['0.27130836  ', '-0.76349378 '], time:0.01730418ms
         out_f32x4: ['0.27130836  ', '-0.76349378 '], time:0.01379824ms
        out_f32_th: ['0.27130836  ', '-0.76349378 '], time:0.10702753ms
-------------------------------------------------------------------------------------
           out_f16: ['0.27124023  ', '-0.76367188 '], time:0.01835012ms
         out_f16x2: ['0.27124023  ', '-0.76367188 '], time:0.01242232ms
         out_f16x8: ['0.27124023  ', '-0.76367188 '], time:0.01111698ms
     out_f16x8pack: ['0.27124023  ', '-0.76367188 '], time:0.01089048ms
        out_f16_th: ['0.27124023  ', '-0.76367188 '], time:0.07636929ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: ['1.75341547  ', '0.94464916  '], time:0.02473760ms
         out_f32x4: ['1.75341547  ', '0.94464916  '], time:0.02046680ms
        out_f32_th: ['1.75341547  ', '0.94464916  '], time:0.28058934ms
-------------------------------------------------------------------------------------
           out_f16: ['1.75292969  ', '0.94482422  '], time:0.02479100ms
         out_f16x2: ['1.75292969  ', '0.94482422  '], time:0.02090597ms
         out_f16x8: ['1.75292969  ', '0.94482422  '], time:0.01453090ms
     out_f16x8pack: ['1.75292969  ', '0.94482422  '], time:0.01415992ms
        out_f16_th: ['1.75292969  ', '0.94482422  '], time:0.09524488ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: ['-0.4527356  ', '0.87371528  '], time:0.19645524ms
         out_f32x4: ['-0.4527356  ', '0.87371528  '], time:0.19622445ms
        out_f32_th: ['-0.4527356  ', '0.87371528  '], time:0.94830012ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.45263672 ', '0.87353516  '], time:0.04213023ms
         out_f16x2: ['-0.45263672 ', '0.87353516  '], time:0.04194713ms
         out_f16x8: ['-0.45263672 ', '0.87353516  '], time:0.02133775ms
     out_f16x8pack: ['-0.45263672 ', '0.87353516  '], time:0.02094197ms
        out_f16_th: ['-0.45263672 ', '0.87353516  '], time:0.32704139ms
-------------------------------------------------------------------------------------